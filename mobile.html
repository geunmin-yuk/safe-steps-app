<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ì•ˆì‹¬ì—¬í–‰">
    
    <title>ì•ˆì‹¬ì—¬í–‰ ìŠ¤í… - ëª¨ë°”ì¼</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%232196F3' d='M50 10c-22.1 0-40 17.9-40 40s17.9 40 40 40 40-17.9 40-40-17.9-40-40-40z'/%3E%3Cpath fill='white' d='M50 20c-16.6 0-30 13.4-30 30s13.4 30 30 30 30-13.4 30-30-13.4-30-30-30z'/%3E%3Cpath fill='%234CAF50' d='M50 30c-11 0-20 9-20 20s9 20 20 20 20-9 20-20-9-20-20-20z'/%3E%3Ctext x='50' y='58' text-anchor='middle' font-size='20' fill='white'%3Eâœˆ%3C/text%3E%3C/svg%3E">
    
    <!-- ì¹´ì¹´ì˜¤ë§µ API -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cb042192382ed6a341ff3f2649753c8f&libraries=services"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ëª¨ë°”ì¼ ìµœì í™” ìŠ¤íƒ€ì¼ */
        html, body {
            height: 100%;
            overflow-x: hidden;
            touch-action: manipulation;
        }
        
        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            z-index: 1000;
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .map-container {
            flex: 1;
            position: relative;
        }
        
        .floating-btn {
            position: fixed;
            z-index: 100;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .floating-btn:active {
            transform: scale(0.95);
        }
        
        .emergency-btn {
            bottom: 100px;
            right: 20px;
            background: linear-gradient(135deg, #f44336, #d32f2f);
            animation: pulse-red 2s infinite;
        }
        
        .location-btn {
            bottom: 170px;
            right: 20px;
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
        
        .search-btn {
            bottom: 240px;
            right: 20px;
            background: linear-gradient(135deg, #4CAF50, #388E3C);
        }
        
        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(244, 67, 54, 0.6); }
        }
        
        .safety-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px;
            z-index: 50;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 200;
            max-height: 70vh;
            overflow-y: auto;
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .bottom-sheet.show {
            transform: translateY(0);
        }
        
        .bottom-sheet-handle {
            width: 40px;
            height: 4px;
            background: #ccc;
            border-radius: 2px;
            margin: 12px auto 8px;
        }
        
        .marker-custom {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border-radius: 20px;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(76, 175, 80, 0.5);
            border: 2px solid white;
        }
        
        .marker-hospital {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(33, 150, 243, 0.5);
            border: 2px solid white;
        }
        
        .marker-aed {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
            border-radius: 50%;
            width: 26px;
            height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            box-shadow: 0 2px 10px rgba(244, 67, 54, 0.5);
            border: 2px solid white;
        }
        
        .install-prompt {
            position: fixed;
            bottom: 80px;
            left: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 16px;
            border-radius: 12px;
            display: none;
            z-index: 150;
        }
        
        @media (max-height: 600px) {
            .emergency-btn { bottom: 80px; }
            .location-btn { bottom: 140px; }
            .search-btn { bottom: 200px; }
        }
        
        /* í„°ì¹˜ í”¼ë“œë°± */
        .touch-feedback:active {
            transform: scale(0.98);
            opacity: 0.8;
        }
        
        /* ì•ˆì „ ì ìˆ˜ ì• ë‹ˆë©”ì´ì…˜ */
        .score-circle {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: conic-gradient(#4CAF50 0% var(--score-percent), #e5e7eb var(--score-percent) 100%);
            padding: 4px;
        }
        
        .score-inner {
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
    </style>
</head>
<body class="bg-gray-100 select-none">
    <div class="app-container">
        <!-- ì•ˆì „ë„ ì˜¤ë²„ë ˆì´ -->
        <div id="safetyOverlay" class="safety-overlay hidden">
            <div class="flex items-center space-x-3">
                <div class="score-circle" style="--score-percent: 95%">
                    <div class="score-inner">
                        <span class="text-lg font-bold text-green-600" id="currentScore">95</span>
                        <span class="text-xs text-gray-500">ì </span>
                    </div>
                </div>
                <div class="flex-1">
                    <div class="flex items-center mb-1">
                        <span class="text-green-600 text-lg mr-2">ğŸ›¡ï¸</span>
                        <span class="font-bold text-green-800">ì™„ë²½í•œ ì•ˆì‹¬ ì§€ì—­</span>
                    </div>
                    <div class="text-sm text-gray-600">
                        <div class="flex items-center space-x-4 text-xs">
                            <span>ğŸ¥ 2ë¶„</span>
                            <span>âš¡ 1ë¶„</span>
                            <span>ğŸ’Š 3ë¶„</span>
                        </div>
                    </div>
                </div>
                <button id="closeOverlay" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
        <div class="map-container">
            <div id="map" class="w-full h-full"></div>
        </div>
        
        <!-- í”Œë¡œíŒ… ë²„íŠ¼ë“¤ -->
        <button id="emergencyFloatingBtn" class="floating-btn emergency-btn touch-feedback">
            <i class="fas fa-phone"></i>
        </button>
        
        <button id="locationFloatingBtn" class="floating-btn location-btn touch-feedback">
            <i class="fas fa-location-dot"></i>
        </button>
        
        <button id="searchFloatingBtn" class="floating-btn search-btn touch-feedback">
            <i class="fas fa-search"></i>
        </button>
        
        <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="bottom-nav">
            <div class="flex justify-around items-center py-2">
                <button id="navMap" class="nav-btn flex flex-col items-center py-2 px-3 text-blue-600 touch-feedback">
                    <i class="fas fa-map text-lg"></i>
                    <span class="text-xs mt-1">ì§€ë„</span>
                </button>
                <button id="navRecommend" class="nav-btn flex flex-col items-center py-2 px-3 text-gray-400 touch-feedback">
                    <i class="fas fa-star text-lg"></i>
                    <span class="text-xs mt-1">ì¶”ì²œ</span>
                </button>
                <button id="navFamily" class="nav-btn flex flex-col items-center py-2 px-3 text-gray-400 touch-feedback">
                    <i class="fas fa-users text-lg"></i>
                    <span class="text-xs mt-1">ê°€ì¡±</span>
                </button>
                <button id="navSafety" class="nav-btn flex flex-col items-center py-2 px-3 text-gray-400 touch-feedback">
                    <i class="fas fa-shield-check text-lg"></i>
                    <span class="text-xs mt-1">ì•ˆì „</span>
                </button>
                <button id="navMore" class="nav-btn flex flex-col items-center py-2 px-3 text-gray-400 touch-feedback">
                    <i class="fas fa-ellipsis-h text-lg"></i>
                    <span class="text-xs mt-1">ë”ë³´ê¸°</span>
                </button>
            </div>
        </nav>
        
        <!-- ê²€ìƒ‰ ë°”í…€ì‹œíŠ¸ -->
        <div id="searchBottomSheet" class="bottom-sheet">
            <div class="bottom-sheet-handle"></div>
            <div class="p-4">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                    <i class="fas fa-search mr-2 text-blue-500"></i>
                    ì•ˆì‹¬ ê´€ê´‘ì§€ ê²€ìƒ‰
                </h3>
                
                <div class="mb-4">
                    <div class="relative">
                        <input 
                            type="text" 
                            id="mobileSearchInput" 
                            placeholder="ì–´ë””ë¡œ ì—¬í–‰ê°€ì‹œë‚˜ìš”?"
                            class="w-full px-4 py-3 bg-gray-100 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:bg-white border-0"
                        >
                        <button id="mobileSearchBtn" class="absolute right-3 top-3 text-blue-500">
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">ì¸ê¸° ê²€ìƒ‰ì–´</h4>
                    <div class="flex flex-wrap gap-2">
                        <button class="search-tag bg-blue-100 text-blue-800 px-3 py-2 rounded-full text-sm touch-feedback" data-search="ì œì£¼ë„">ì œì£¼ë„</button>
                        <button class="search-tag bg-green-100 text-green-800 px-3 py-2 rounded-full text-sm touch-feedback" data-search="ì„¤ì•…ì‚°">ì„¤ì•…ì‚°</button>
                        <button class="search-tag bg-purple-100 text-purple-800 px-3 py-2 rounded-full text-sm touch-feedback" data-search="ë¶€ì‚°">ë¶€ì‚°</button>
                        <button class="search-tag bg-yellow-100 text-yellow-800 px-3 py-2 rounded-full text-sm touch-feedback" data-search="ê²½ì£¼">ê²½ì£¼</button>
                        <button class="search-tag bg-pink-100 text-pink-800 px-3 py-2 rounded-full text-sm touch-feedback" data-search="ì—¬ìˆ˜">ì—¬ìˆ˜</button>
                        <button class="search-tag bg-indigo-100 text-indigo-800 px-3 py-2 rounded-full text-sm touch-feedback" data-search="ì „ì£¼">ì „ì£¼</button>
                    </div>
                </div>
                
                <div>
                    <h4 class="text-sm font-medium text-gray-700 mb-3">ìµœê·¼ ê²€ìƒ‰</h4>
                    <div id="recentSearches" class="space-y-2">
                        <!-- ìµœê·¼ ê²€ìƒ‰ì–´ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ì¶”ì²œ ë°”í…€ì‹œíŠ¸ -->
        <div id="recommendBottomSheet" class="bottom-sheet">
            <div class="bottom-sheet-handle"></div>
            <div class="p-4">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                    <i class="fas fa-star mr-2 text-yellow-500"></i>
                    ì´ë²ˆ ì£¼ë§ ì¶”ì²œ ì—¬í–‰ì§€
                </h3>
                
                <div id="mobileRecommendedPlaces" class="space-y-4">
                    <!-- ì¶”ì²œ ì¥ì†Œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
        
        <!-- ê°€ì¡± ë°”í…€ì‹œíŠ¸ -->
        <div id="familyBottomSheet" class="bottom-sheet">
            <div class="bottom-sheet-handle"></div>
            <div class="p-4">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                    <i class="fas fa-users mr-2 text-purple-500"></i>
                    ê°€ì¡± ì—¬í–‰ ì„¤ì •
                </h3>
                
                <div class="mb-6">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">ìš°ë¦¬ ê°€ì¡± êµ¬ì„±ì›</h4>
                    <div class="space-y-3">
                        <div class="family-member bg-gray-50 rounded-lg p-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                        <span class="text-sm">ğŸ‘´</span>
                                    </div>
                                    <div>
                                        <div class="text-sm font-medium">í• ì•„ë²„ì§€ (78ì„¸)</div>
                                        <div class="text-xs text-gray-500">ê´€ì ˆ, ê³ í˜ˆì••</div>
                                    </div>
                                </div>
                                <button class="text-red-500 text-sm">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="family-member bg-gray-50 rounded-lg p-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-pink-100 rounded-full flex items-center justify-center">
                                        <span class="text-sm">ğŸ‘¶</span>
                                    </div>
                                    <div>
                                        <div class="text-sm font-medium">ì•„ê¸° (2ì„¸)</div>
                                        <div class="text-xs text-gray-500">ì†Œì•„ê³¼ í•„ìˆ˜</div>
                                    </div>
                                </div>
                                <button class="text-red-500 text-sm">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <button class="w-full mt-3 py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 touch-feedback">
                        <i class="fas fa-plus mr-2"></i>
                        ê°€ì¡± êµ¬ì„±ì› ì¶”ê°€
                    </button>
                </div>
                
                <div class="mb-4">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">ì—¬í–‰ ìŠ¤íƒ€ì¼</h4>
                    <div class="grid grid-cols-2 gap-2">
                        <button class="travel-style-btn bg-blue-500 text-white p-3 rounded-lg text-sm touch-feedback">
                            ğŸ”ï¸ ìì—° íƒí—˜
                        </button>
                        <button class="travel-style-btn bg-gray-200 text-gray-700 p-3 rounded-lg text-sm touch-feedback">
                            ğŸ›ï¸ ë¬¸í™” ì²´í—˜
                        </button>
                        <button class="travel-style-btn bg-gray-200 text-gray-700 p-3 rounded-lg text-sm touch-feedback">
                            ğŸœ ë§›ì§‘ íˆ¬ì–´
                        </button>
                        <button class="travel-style-btn bg-gray-200 text-gray-700 p-3 rounded-lg text-sm touch-feedback">
                            ğŸ§˜â€â™€ï¸ íë§ ì—¬í–‰
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ì•ˆì „ ì •ë³´ ë°”í…€ì‹œíŠ¸ -->
        <div id="safetyBottomSheet" class="bottom-sheet">
            <div class="bottom-sheet-handle"></div>
            <div class="p-4">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                    <i class="fas fa-shield-check mr-2 text-green-500"></i>
                    ì•ˆì „ ì •ë³´ ì„¼í„°
                </h3>
                
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div class="bg-green-100 p-4 rounded-lg text-center">
                        <div class="text-2xl mb-2">ğŸ¥</div>
                        <div class="text-xs text-gray-600">ì‘ê¸‰ì‹¤</div>
                        <div class="text-sm font-bold text-green-700">2ë¶„ ê±°ë¦¬</div>
                    </div>
                    <div class="bg-red-100 p-4 rounded-lg text-center">
                        <div class="text-2xl mb-2">âš¡</div>
                        <div class="text-xs text-gray-600">AED</div>
                        <div class="text-sm font-bold text-red-700">1ë¶„ ê±°ë¦¬</div>
                    </div>
                    <div class="bg-blue-100 p-4 rounded-lg text-center">
                        <div class="text-2xl mb-2">ğŸ’Š</div>
                        <div class="text-xs text-gray-600">24ì‹œê°„ ì•½êµ­</div>
                        <div class="text-sm font-bold text-blue-700">3ë¶„ ê±°ë¦¬</div>
                    </div>
                    <div class="bg-purple-100 p-4 rounded-lg text-center">
                        <div class="text-2xl mb-2">ğŸ‘¨â€âš•ï¸</div>
                        <div class="text-xs text-gray-600">ì˜ë£Œì§„ ìƒë‹´</div>
                        <div class="text-sm font-bold text-purple-700">24ì‹œê°„</div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">ì˜¤ëŠ˜ì˜ ì•ˆì „ ì•Œë¦¼</h4>
                    <div class="space-y-2">
                        <div class="bg-green-50 border-l-4 border-green-400 p-3 rounded">
                            <div class="flex items-center">
                                <span class="text-green-600 mr-2">âœ…</span>
                                <span class="text-sm text-green-800">ì „êµ­ ê´€ê´‘ì§€ í‰ê·  ì•ˆì „ë„ 87ì  ë‹¬ì„±</span>
                            </div>
                        </div>
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-3 rounded">
                            <div class="flex items-center">
                                <span class="text-blue-600 mr-2">â˜€ï¸</span>
                                <span class="text-sm text-blue-800">ì´ë²ˆ ì£¼ë§ ì „êµ­ ë§‘ìŒ, ì•¼ì™¸í™œë™ ìµœì </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ì‘ê¸‰ìƒí™© ëª¨ë‹¬ -->
        <div id="emergencyModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl max-w-sm w-full p-6">
                <div class="text-center mb-6">
                    <div class="text-6xl text-red-500 mb-4">ğŸš¨</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">ì‘ê¸‰ìƒí™© ëŒ€ì‘</h3>
                    <p class="text-gray-600 text-sm">ìƒí™©ì„ ì„ íƒí•˜ë©´ ìµœì ì˜ ë³‘ì›ì„ ì•ˆë‚´í•©ë‹ˆë‹¤</p>
                </div>
                
                <div class="space-y-3 mb-6">
                    <button class="emergency-type-btn w-full bg-red-500 text-white p-4 rounded-xl hover:bg-red-600 transition-colors touch-feedback" data-emergency="chest_pain">
                        <i class="fas fa-heart mr-3"></i>ê°€ìŠ´ í†µì¦ / í˜¸í¡ê³¤ë€
                    </button>
                    <button class="emergency-type-btn w-full bg-red-500 text-white p-4 rounded-xl hover:bg-red-600 transition-colors touch-feedback" data-emergency="unconscious">
                        <i class="fas fa-user-injured mr-3"></i>ì˜ì‹ìƒìŒ / ì“°ëŸ¬ì§
                    </button>
                    <button class="emergency-type-btn w-full bg-red-500 text-white p-4 rounded-xl hover:bg-red-600 transition-colors touch-feedback" data-emergency="bleeding">
                        <i class="fas fa-droplet mr-3"></i>ì‹¬í•œ ì¶œí˜ˆ / ì™¸ìƒ
                    </button>
                    <button class="emergency-type-btn w-full bg-red-500 text-white p-4 rounded-xl hover:bg-red-600 transition-colors touch-feedback" data-emergency="other">
                        <i class="fas fa-exclamation-triangle mr-3"></i>ê¸°íƒ€ ì‘ê¸‰ìƒí™©
                    </button>
                </div>
                
                <div class="flex space-x-3">
                    <button id="call119Mobile" class="flex-1 bg-green-500 text-white p-3 rounded-xl hover:bg-green-600 transition-colors touch-feedback">
                        <i class="fas fa-phone mr-2"></i>119 ì‹ ê³ 
                    </button>
                    <button id="closeEmergencyModal" class="flex-1 bg-gray-500 text-white p-3 rounded-xl hover:bg-gray-600 transition-colors touch-feedback">
                        ì·¨ì†Œ
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ì•± ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ -->
        <div id="installPrompt" class="install-prompt">
            <div class="flex items-center justify-between">
                <div class="flex-1">
                    <div class="font-bold text-sm mb-1">ğŸ“± ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ê¸°</div>
                    <div class="text-xs opacity-90">ë” ë¹ ë¥´ê³  í¸ë¦¬í•˜ê²Œ ì´ìš©í•˜ì„¸ìš”</div>
                </div>
                <div class="flex space-x-2 ml-4">
                    <button id="installApp" class="bg-white text-purple-600 px-3 py-1 rounded-lg text-sm font-medium touch-feedback">
                        ì„¤ì¹˜
                    </button>
                    <button id="dismissInstall" class="text-white opacity-75 touch-feedback">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ë¡œë”© -->
    <div id="mobileLoading" class="fixed inset-0 bg-white z-50 hidden flex items-center justify-center">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
            <p class="text-gray-600">ì•ˆì‹¬ ì •ë³´ ë¡œë”© ì¤‘...</p>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let mobileMap;
        let mobileMarkers = [];
        let currentBottomSheet = null;
        let deferredPrompt;
        
        // PWA ì´ˆê¸°í™”
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('service-worker.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    }, function(err) {
                        console.log('ServiceWorker registration failed');
                    });
            });
        }
        
        // ì•± ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ í‘œì‹œ
            setTimeout(() => {
                document.getElementById('installPrompt').style.display = 'block';
            }, 3000);
        });
        
        // ëª¨ë°”ì¼ ì§€ë„ ì´ˆê¸°í™”
        function initializeMobileMap() {
            const container = document.getElementById('map');
            const options = {
                center: new kakao.maps.LatLng(37.5665, 126.9780),
                level: 6,
                mapTypeId: kakao.maps.MapTypeId.ROADMAP
            };
            
            mobileMap = new kakao.maps.Map(container, options);
            
            // í„°ì¹˜ ì´ë²¤íŠ¸ ì²˜ë¦¬
            kakao.maps.event.addListener(mobileMap, 'click', function(mouseEvent) {
                const latlng = mouseEvent.latLng;
                showMobileLocationSafety(latlng);
            });
            
            // ë°ëª¨ ë°ì´í„° ë¡œë“œ
            loadMobileDemoData();
            
            // í˜„ì¬ ìœ„ì¹˜ ìë™ í™•ì¸ (ëª¨ë°”ì¼ ì „ìš©)
            getCurrentLocationMobile();
        }
        
        // ëª¨ë°”ì¼ ë°ëª¨ ë°ì´í„°
        function loadMobileDemoData() {
            const mobileDemo = [
                {
                    name: 'ì œì£¼ í•œë¼ì‚°',
                    lat: 33.3617, lng: 126.5292,
                    safetyScore: 92,
                    features: ['ì¢…í•©ë³‘ì› 10ë¶„', 'í—¬ê¸° ì°©ë¥™ì¥', 'AED ì™„ë¹„']
                },
                {
                    name: 'ë¶€ì‚° í•´ìš´ëŒ€',
                    lat: 35.1587, lng: 129.1604,
                    safetyScore: 95,
                    features: ['í•´ìƒêµ¬ì¡°ëŒ€', '24ì‹œê°„ ì‘ê¸‰ì‹¤', 'ì˜ë£Œì§„ ìƒì£¼']
                },
                {
                    name: 'ì„¤ì•…ì‚° êµ­ë¦½ê³µì›',
                    lat: 38.1192, lng: 128.4651,
                    safetyScore: 87,
                    features: ['ì‚°ì•…êµ¬ì¡°ëŒ€', 'ì‘ê¸‰í—¬ê¸°', 'ì˜ë£Œì§„ ëŒ€ê¸°']
                },
                {
                    name: 'ê²½ì£¼ ë¶ˆêµ­ì‚¬',
                    lat: 35.7898, lng: 129.3320,
                    safetyScore: 89,
                    features: ['ì‘ê¸‰ì²˜ì¹˜ì‹¤', 'AED', 'ì˜ë£Œì§„ ìˆœì°°']
                }
            ];
            
            mobileDemo.forEach(place => {
                addMobileSafetyMarker(place);
            });
            
            displayMobileRecommendations(mobileDemo);
        }
        
        // ëª¨ë°”ì¼ ì•ˆì „ ë§ˆì»¤ ì¶”ê°€
        function addMobileSafetyMarker(place) {
            const position = new kakao.maps.LatLng(place.lat, place.lng);
            
            let markerColor = place.safetyScore >= 90 ? '#4CAF50' : 
                             place.safetyScore >= 80 ? '#2196F3' : '#FFC107';
            
            const markerContent = `
                <div class="marker-custom" style="background: linear-gradient(135deg, ${markerColor}, ${markerColor}dd)">
                    ğŸ† ${place.safetyScore}
                </div>
            `;
            
            const customOverlay = new kakao.maps.CustomOverlay({
                position: position,
                content: markerContent,
                yAnchor: 1
            });
            
            customOverlay.setMap(mobileMap);
            
            // í„°ì¹˜ ì´ë²¤íŠ¸
            const overlayElement = customOverlay.getContent();
            overlayElement.addEventListener('click', function() {
                showMobilePlaceInfo(place);
                // í–…í‹± í”¼ë“œë°± (ì§€ì›ë˜ëŠ” ê²½ìš°)
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
            });
            
            mobileMarkers.push({ overlay: customOverlay, data: place });
        }
        
        // ëª¨ë°”ì¼ ì¥ì†Œ ì •ë³´ í‘œì‹œ
        function showMobilePlaceInfo(place) {
            // ì§„ë™ í”¼ë“œë°±
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100]);
            }
            
            const alert = `ğŸ† ${place.name}\n\n` +
                         `ğŸ›¡ï¸ ì•ˆì „ë„: ${place.safetyScore}/100ì \n\n` +
                         `âœ… ì•ˆì‹¬ í¬ì¸íŠ¸:\n${place.features.map(f => `â€¢ ${f}`).join('\n')}\n\n` +
                         `ì™„ë²½í•œ ì•ˆì „ ì‹œì„¤ë¡œ ê°€ì¡± ëª¨ë‘ ì•ˆì‹¬í•˜ê³  ì¦ê¸°ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸ˜Š`;
            
            if (confirm(alert + '\n\nğŸ“ ì´ ê³³ìœ¼ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                mobileMap.setCenter(new kakao.maps.LatLng(place.lat, place.lng));
                mobileMap.setLevel(4);
                showMobileNotification(`${place.name}ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤! ğŸ¯`);
            }
        }
        
        // í˜„ì¬ ìœ„ì¹˜ í™•ì¸ (ëª¨ë°”ì¼)
        function getCurrentLocationMobile() {
            if (navigator.geolocation) {
                const options = {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                };
                
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        const latlng = new kakao.maps.LatLng(lat, lng);
                        
                        // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤
                        const currentLocationContent = `
                            <div style="
                                background: linear-gradient(135deg, #FF5722, #F44336);
                                color: white;
                                padding: 6px 12px;
                                border-radius: 20px;
                                font-size: 12px;
                                font-weight: bold;
                                box-shadow: 0 4px 12px rgba(255,87,34,0.6);
                                border: 2px solid white;
                                animation: pulse 2s infinite;
                            ">
                                ğŸ“ ë‚´ ìœ„ì¹˜
                            </div>
                        `;
                        
                        const currentLocationOverlay = new kakao.maps.CustomOverlay({
                            position: latlng,
                            content: currentLocationContent,
                            yAnchor: 1
                        });
                        
                        currentLocationOverlay.setMap(mobileMap);
                        
                        // ì§€ë„ ì¤‘ì‹¬ ì´ë™
                        mobileMap.setCenter(latlng);
                        mobileMap.setLevel(5);
                        
                        // í˜„ì¬ ìœ„ì¹˜ ì•ˆì „ë„ í‘œì‹œ
                        showMobileLocationSafety(latlng);
                        
                        // ì§„ë™ í”¼ë“œë°±
                        if (navigator.vibrate) {
                            navigator.vibrate([200, 100, 200]);
                        }
                    },
                    function(error) {
                        console.log('ìœ„ì¹˜ ì •ë³´ ì˜¤ë¥˜:', error);
                    },
                    options
                );
            }
        }
        
        // ìœ„ì¹˜ ì•ˆì „ë„ í‘œì‹œ (ëª¨ë°”ì¼)
        function showMobileLocationSafety(latlng) {
            const safetyScore = Math.floor(Math.random() * 15) + 85;
            const overlay = document.getElementById('safetyOverlay');
            const scoreElement = document.getElementById('currentScore');
            
            scoreElement.textContent = safetyScore;
            overlay.querySelector('.score-circle').style.setProperty('--score-percent', safetyScore + '%');
            
            overlay.classList.remove('hidden');
            
            // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
            setTimeout(() => {
                if (!overlay.classList.contains('hidden')) {
                    overlay.classList.add('hidden');
                }
            }, 5000);
        }
        
        // ë°”í…€ì‹œíŠ¸ ê´€ë¦¬
        function showBottomSheet(sheetId) {
            // í˜„ì¬ ì—´ë¦° ì‹œíŠ¸ ë‹«ê¸°
            if (currentBottomSheet) {
                currentBottomSheet.classList.remove('show');
            }
            
            // ìƒˆ ì‹œíŠ¸ ì—´ê¸°
            const sheet = document.getElementById(sheetId);
            if (sheet) {
                sheet.classList.add('show');
                currentBottomSheet = sheet;
                
                // ì§„ë™ í”¼ë“œë°±
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
            }
        }
        
        function hideBottomSheet() {
            if (currentBottomSheet) {
                currentBottomSheet.classList.remove('show');
                currentBottomSheet = null;
            }
        }
        
        // ëª¨ë°”ì¼ ì¶”ì²œ ì¥ì†Œ í‘œì‹œ
        function displayMobileRecommendations(places) {
            const container = document.getElementById('mobileRecommendedPlaces');
            container.innerHTML = '';
            
            places.forEach(place => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-2xl shadow-lg p-4 touch-feedback';
                card.style.cursor = 'pointer';
                
                const safetyColor = place.safetyScore >= 90 ? 'green' : 
                                   place.safetyScore >= 80 ? 'blue' : 'yellow';
                
                card.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-xl flex items-center justify-center text-2xl">
                            ${place.name.includes('ì œì£¼') ? 'ğŸï¸' : 
                              place.name.includes('ë¶€ì‚°') ? 'ğŸ–ï¸' : 
                              place.name.includes('ì„¤ì•…ì‚°') ? 'ğŸ”ï¸' : 'ğŸ›ï¸'}
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="font-bold text-gray-800">${place.name}</h3>
                                <span class="bg-${safetyColor}-100 text-${safetyColor}-800 px-2 py-1 rounded-full text-xs font-bold">
                                    ğŸ† ${place.safetyScore}ì 
                                </span>
                            </div>
                            <div class="text-xs text-gray-600 space-y-1">
                                ${place.features.slice(0, 2).map(feature => 
                                    `<div>âœ… ${feature}</div>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                card.addEventListener('click', function() {
                    moveToMobilePlace(place.lat, place.lng, place.name);
                    hideBottomSheet();
                });
                
                container.appendChild(card);
            });
        }
        
        // ì¥ì†Œë¡œ ì´ë™ (ëª¨ë°”ì¼)
        function moveToMobilePlace(lat, lng, name) {
            const position = new kakao.maps.LatLng(lat, lng);
            mobileMap.setCenter(position);
            mobileMap.setLevel(4);
            
            showMobileLocationSafety(position);
            showMobileNotification(`${name}ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤! ğŸŒŸ`);
            
            // ì§„ë™ í”¼ë“œë°±
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100]);
            }
        }
        
        // ëª¨ë°”ì¼ ì•Œë¦¼
        function showMobileNotification(message, duration = 3000) {
            const notification = document.createElement('div');
            notification.className = `
                fixed top-4 left-4 right-4 z-50
                bg-white border-l-4 border-green-500 
                rounded-lg shadow-lg p-4
                transform transition-all duration-300
                translate-y-[-100px] opacity-0
            `;
            
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="text-green-500 text-xl">âœ…</div>
                    <div class="flex-1 text-sm text-gray-800">${message}</div>
                    <button class="text-gray-400" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // ì• ë‹ˆë©”ì´ì…˜
            setTimeout(() => {
                notification.style.transform = 'translateY(0)';
                notification.style.opacity = '1';
            }, 100);
            
            // ìë™ ì œê±°
            setTimeout(() => {
                notification.style.transform = 'translateY(-100px)';
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, duration);
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        document.addEventListener('DOMContentLoaded', function() {
            // ì§€ë„ ì´ˆê¸°í™”
            initializeMobileMap();
            
            // í”Œë¡œíŒ… ë²„íŠ¼ë“¤
            document.getElementById('emergencyFloatingBtn').addEventListener('click', function() {
                document.getElementById('emergencyModal').classList.remove('hidden');
            });
            
            document.getElementById('locationFloatingBtn').addEventListener('click', function() {
                getCurrentLocationMobile();
                showMobileNotification('í˜„ì¬ ìœ„ì¹˜ë¥¼ í™•ì¸í•©ë‹ˆë‹¤ ğŸ“');
            });
            
            document.getElementById('searchFloatingBtn').addEventListener('click', function() {
                showBottomSheet('searchBottomSheet');
            });
            
            // í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // í™œì„± ìƒíƒœ ë³€ê²½
                    document.querySelectorAll('.nav-btn').forEach(b => {
                        b.classList.remove('text-blue-600');
                        b.classList.add('text-gray-400');
                    });
                    this.classList.remove('text-gray-400');
                    this.classList.add('text-blue-600');
                    
                    // í•´ë‹¹ ë°”í…€ì‹œíŠ¸ í‘œì‹œ
                    const navId = this.id.replace('nav', '').toLowerCase();
                    if (navId === 'map') {
                        hideBottomSheet();
                    } else if (navId === 'recommend') {
                        showBottomSheet('recommendBottomSheet');
                    } else if (navId === 'family') {
                        showBottomSheet('familyBottomSheet');
                    } else if (navId === 'safety') {
                        showBottomSheet('safetyBottomSheet');
                    }
                });
            });
            
            // ê²€ìƒ‰ ê¸°ëŠ¥
            document.getElementById('mobileSearchBtn').addEventListener('click', function() {
                const query = document.getElementById('mobileSearchInput').value.trim();
                performMobileSearch(query);
            });
            
            document.getElementById('mobileSearchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const query = this.value.trim();
                    performMobileSearch(query);
                }
            });
            
            // ê²€ìƒ‰ íƒœê·¸ë“¤
            document.querySelectorAll('.search-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    const query = this.dataset.search;
                    performMobileSearch(query);
                });
            });
            
            // ì‘ê¸‰ìƒí™© ëª¨ë‹¬
            document.querySelectorAll('.emergency-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.dataset.emergency;
                    handleMobileEmergency(type);
                });
            });
            
            document.getElementById('call119Mobile').addEventListener('click', function() {
                if (confirm('119ì— ì‹ ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‹¤ì œ ì‘ê¸‰ìƒí™©ì—ì„œëŠ” ì¦‰ì‹œ 119ì— ì‹ ê³ í•˜ì„¸ìš”.')) {
                    // ì‹¤ì œë¡œëŠ” tel:119 ë§í¬ë¥¼ ì‚¬ìš©
                    showMobileNotification('119 ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸš¨');
                }
            });
            
            document.getElementById('closeEmergencyModal').addEventListener('click', function() {
                document.getElementById('emergencyModal').classList.add('hidden');
            });
            
            // ì˜¤ë²„ë ˆì´ ë‹«ê¸°
            document.getElementById('closeOverlay').addEventListener('click', function() {
                document.getElementById('safetyOverlay').classList.add('hidden');
            });
            
            // PWA ì„¤ì¹˜ ë²„íŠ¼
            document.getElementById('installApp').addEventListener('click', function() {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        deferredPrompt = null;
                        document.getElementById('installPrompt').style.display = 'none';
                    });
                }
            });
            
            document.getElementById('dismissInstall').addEventListener('click', function() {
                document.getElementById('installPrompt').style.display = 'none';
            });
            
            // ë°”í…€ì‹œíŠ¸ ë°°ê²½ í„°ì¹˜ì‹œ ë‹«ê¸°
            document.addEventListener('click', function(e) {
                if (currentBottomSheet && !currentBottomSheet.contains(e.target) && 
                    !e.target.closest('.nav-btn') && 
                    !e.target.closest('.floating-btn')) {
                    hideBottomSheet();
                }
            });
            
            // í™˜ì˜ ë©”ì‹œì§€
            setTimeout(() => {
                showMobileNotification('ì•ˆì‹¬ì—¬í–‰ ìŠ¤í… ëª¨ë°”ì¼ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‰', 4000);
            }, 1000);
        });
        
        // ëª¨ë°”ì¼ ê²€ìƒ‰ ìˆ˜í–‰
        function performMobileSearch(query) {
            if (!query) return;
            
            showMobileLoading(true);
            
            const ps = new kakao.maps.services.Places();
            ps.keywordSearch(query, function(data, status, pagination) {
                showMobileLoading(false);
                
                if (status === kakao.maps.services.Status.OK) {
                    const place = data[0];
                    const position = new kakao.maps.LatLng(place.y, place.x);
                    
                    mobileMap.setCenter(position);
                    mobileMap.setLevel(5);
                    
                    showMobileLocationSafety(position);
                    showMobileNotification(`${place.place_name}ì„(ë¥¼) ì°¾ì•˜ìŠµë‹ˆë‹¤! ğŸ¯`);
                    
                    // ìµœê·¼ ê²€ìƒ‰ì–´ì— ì¶”ê°€
                    addToRecentSearches(query);
                    
                    hideBottomSheet();
                } else {
                    showMobileNotification('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤ ğŸ”');
                }
            });
        }
        
        // ìµœê·¼ ê²€ìƒ‰ì–´ ì¶”ê°€
        function addToRecentSearches(query) {
            const recentContainer = document.getElementById('recentSearches');
            const recentItem = document.createElement('div');
            recentItem.className = 'flex items-center justify-between py-2 border-b border-gray-100';
            
            recentItem.innerHTML = `
                <div class="flex items-center space-x-3">
                    <i class="fas fa-clock text-gray-400"></i>
                    <span class="text-sm">${query}</span>
                </div>
                <button class="text-gray-400 text-sm" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            recentItem.addEventListener('click', function() {
                performMobileSearch(query);
            });
            
            recentContainer.insertBefore(recentItem, recentContainer.firstChild);
        }
        
        // ëª¨ë°”ì¼ ì‘ê¸‰ìƒí™© ì²˜ë¦¬
        function handleMobileEmergency(type) {
            const emergencyInfo = {
                chest_pain: { hospital: 'ì‹¬ì¥ë‚´ê³¼', time: '3ë¶„', name: 'ê°•ë‚¨ì„¸ë¸Œë€ìŠ¤ë³‘ì›' },
                unconscious: { hospital: 'ì‘ê¸‰ì‹¤', time: '2ë¶„', name: 'ì‚¼ì„±ì„œìš¸ë³‘ì›' },
                bleeding: { hospital: 'ì™¸ìƒì™¸ê³¼', time: '4ë¶„', name: 'ì„œìš¸ì•„ì‚°ë³‘ì›' },
                other: { hospital: 'ì‘ê¸‰ì‹¤', time: '5ë¶„', name: 'ì„œìš¸ëŒ€í•™êµë³‘ì›' }
            };
            
            const info = emergencyInfo[type];
            
            // ì§„ë™ í”¼ë“œë°±
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
            
            alert(`ğŸš¨ ì‘ê¸‰ìƒí™© ëŒ€ì‘ ì•ˆë‚´\n\n` +
                  `ğŸ¥ ìµœì  ë³‘ì›: ${info.name}\n` +
                  `âš•ï¸ ì „ë¬¸ê³¼: ${info.hospital}\n` +
                  `ğŸš— ì˜ˆìƒì‹œê°„: ${info.time}\n\n` +
                  `ì¦‰ì‹œ 119ì— ì‹ ê³ í•˜ê³  ë³‘ì›ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”.\n\n` +
                  `ğŸ“ ë³‘ì›ìœ¼ë¡œ ê¸¸ì•ˆë‚´ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.`);
            
            document.getElementById('emergencyModal').classList.add('hidden');
            showMobileNotification(`${info.name} ê¸¸ì•ˆë‚´ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤ ğŸš—`);
        }
        
        // ëª¨ë°”ì¼ ë¡œë”©
        function showMobileLoading(show) {
            const loading = document.getElementById('mobileLoading');
            if (show) {
                loading.classList.remove('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }
        
        // í„°ì¹˜ ì œìŠ¤ì²˜ ì²˜ë¦¬
        let touchStartY = 0;
        let touchEndY = 0;
        
        document.addEventListener('touchstart', function(e) {
            touchStartY = e.changedTouches[0].screenY;
        });
        
        document.addEventListener('touchend', function(e) {
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        });
        
        function handleSwipe() {
            const swipeDistance = touchStartY - touchEndY;
            
            // ìœ„ë¡œ ìŠ¤ì™€ì´í”„ (ë°”í…€ì‹œíŠ¸ ì—´ê¸°)
            if (swipeDistance > 50 && !currentBottomSheet) {
                showBottomSheet('recommendBottomSheet');
            }
            // ì•„ë˜ë¡œ ìŠ¤ì™€ì´í”„ (ë°”í…€ì‹œíŠ¸ ë‹«ê¸°)
            else if (swipeDistance < -50 && currentBottomSheet) {
                hideBottomSheet();
            }
        }
    </script>
</body>
</html>