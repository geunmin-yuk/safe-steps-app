<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏïàÏã¨Ïó¨Ìñâ Ïä§ÌÖù - Safe Steps</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-glow {
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .safety-score-circle {
            background: conic-gradient(
                #10b981 0% var(--score-percent), 
                #e5e7eb var(--score-percent) 100%
            );
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: scoreAnimation 2s ease-out;
        }
        
        .safety-score-inner {
            background: white;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        @keyframes scoreAnimation {
            from { --score-percent: 0%; }
            to { --score-percent: var(--final-score); }
        }
        
        .modern-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 24px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .modern-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .pulse-dot {
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            position: relative;
            animation: pulse 2s infinite;
        }
        
        .pulse-dot::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border-radius: 50%;
            background: #10b981;
            opacity: 0.6;
            animation: pulse-ring 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes pulse-ring {
            0% { transform: scale(1); opacity: 0.6; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        .floating-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            width: 56px;
            height: 56px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }
        
        .floating-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }
        
        .emergency-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            animation: emergencyPulse 2s infinite;
        }
        
        @keyframes emergencyPulse {
            0%, 100% { box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 8px 35px rgba(239, 68, 68, 0.8); }
        }
        
        .hero-section {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: 32px;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(20px);
        }
        
        .search-input {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            background: rgba(255,255,255,1);
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
    </style>
</head>

<body>
    <!-- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà -->
    <div class="min-h-screen p-4">
        <!-- Ìó§Îçî -->
        <header class="hero-section p-6 mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-2xl shadow-lg">
                        ‚úàÔ∏è
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">ÏïàÏã¨Ïó¨Ìñâ Ïä§ÌÖù</h1>
                        <p class="text-white/80 text-sm">Safe & Smart Travel Guide</p>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button id="currentLocationBtn" class="floating-btn flex items-center justify-center text-white hover:scale-105 transition-transform">
                        <i class="fas fa-location-dot text-lg"></i>
                    </button>
                    <button id="emergencyBtn" class="floating-btn emergency-btn flex items-center justify-center text-white">
                        <i class="fas fa-phone text-lg"></i>
                    </button>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto grid grid-cols-1 xl:grid-cols-3 gap-8">
            <!-- ÏôºÏ™Ω: Í≤ÄÏÉâ & ÏïàÏ†ÑÎèÑ -->
            <div class="xl:col-span-1 space-y-6">
                <!-- Í≤ÄÏÉâ ÏÑπÏÖò -->
                <div class="modern-card p-6">
                    <div class="mb-4">
                        <h2 class="text-xl font-semibold gradient-text mb-2">Ïó¨ÌñâÏßÄ Í≤ÄÏÉâ</h2>
                        <div class="relative">
                            <input 
                                type="text" 
                                id="searchInput" 
                                placeholder="Ïñ¥ÎîîÎ°ú Îñ†ÎÇòÏãúÎÇòÏöî?"
                                class="search-input w-full px-6 py-4 text-lg focus:outline-none"
                            >
                            <button id="searchBtn" class="absolute right-2 top-2 w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:scale-105 transition-transform">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ÌòÑÏû¨ ÏúÑÏπò ÏïàÏ†ÑÎèÑ -->
                <div id="safetyCard" class="modern-card p-8 text-center">
                    <div class="mb-6">
                        <h3 class="text-lg font-medium text-gray-600 mb-4">ÌòÑÏû¨ ÏúÑÏπò ÏïàÏ†ÑÎèÑ</h3>
                        <div class="flex justify-center mb-4">
                            <div class="safety-score-circle" style="--score-percent: 95%; --final-score: 95%;">
                                <div class="safety-score-inner">
                                    <span class="text-3xl font-bold text-green-600" id="safetyScore">95</span>
                                    <span class="text-sm text-gray-500">Ï†ê</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center justify-center space-x-2 mb-4">
                            <div class="pulse-dot"></div>
                            <span class="text-green-600 font-semibold">ÏôÑÎ≤ΩÌïú ÏïàÏã¨ ÏßÄÏó≠</span>
                        </div>
                    </div>
                    
                    <!-- ÌïµÏã¨ ÏïàÏ†Ñ Ï†ïÎ≥¥ -->
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-green-50 rounded-2xl p-4">
                            <div class="text-2xl mb-1">üè•</div>
                            <div class="text-xs text-gray-600">ÏùëÍ∏âÏã§</div>
                            <div class="text-lg font-bold text-green-600">4Î∂Ñ</div>
                        </div>
                        <div class="bg-red-50 rounded-2xl p-4">
                            <div class="text-2xl mb-1">‚ö°</div>
                            <div class="text-xs text-gray-600">AED</div>
                            <div class="text-lg font-bold text-red-600">1Î∂Ñ</div>
                        </div>
                        <div class="bg-blue-50 rounded-2xl p-4">
                            <div class="text-2xl mb-1">üíä</div>
                            <div class="text-xs text-gray-600">ÏïΩÍµ≠</div>
                            <div class="text-lg font-bold text-blue-600">6Î∂Ñ</div>
                        </div>
                    </div>
                </div>

                <!-- Îπ†Î•∏ Ïï°ÏÖò -->
                <div class="modern-card p-6">
                    <h3 class="text-lg font-semibold mb-4">Îπ†Î•∏ ÏÑúÎπÑÏä§</h3>
                    <div class="space-y-3">
                        <button class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4 rounded-2xl font-medium hover:scale-105 transition-transform">
                            üèîÔ∏è ÏÇ∞ÏïÖ Ïó¨Ìñâ ÏïàÏ†Ñ Í∞ÄÏù¥Îìú
                        </button>
                        <button class="w-full bg-gradient-to-r from-blue-500 to-cyan-600 text-white py-4 rounded-2xl font-medium hover:scale-105 transition-transform">
                            üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Í∞ÄÏ°± Ïó¨Ìñâ Ï∂îÏ≤ú
                        </button>
                        <button class="w-full bg-gradient-to-r from-purple-500 to-pink-600 text-white py-4 rounded-2xl font-medium hover:scale-105 transition-transform">
                            üéØ ÎßûÏ∂§Ìòï ÏïàÏ†Ñ Ï≤¥ÌÅ¨
                        </button>
                    </div>
                </div>
            </div>

            <!-- Ïò§Î•∏Ï™Ω: ÏßÄÎèÑ -->
            <div class="xl:col-span-2">
                <div class="modern-card p-6 h-full">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h2 class="text-xl font-semibold gradient-text">Ïã§ÏãúÍ∞Ñ ÏïàÏã¨ ÏßÄÎèÑ</h2>
                            <p class="text-gray-500 text-sm">Ï†ÑÍµ≠ Í¥ÄÍ¥ëÏßÄ ÏïàÏ†Ñ Ï†ïÎ≥¥</p>
                        </div>
                        <div class="flex space-x-2">
                            <div class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-medium">
                                üè• Î≥ëÏõê <span id="hospitalCount">3</span>
                            </div>
                            <div class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-medium">
                                ‚ö° AED <span id="aedCount">2</span>
                            </div>
                            <div class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-medium">
                                üíä ÏïΩÍµ≠ <span id="pharmacyCount">24</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ïπ¥Ïπ¥Ïò§Îßµ -->
                    <div id="map" class="w-full rounded-2xl overflow-hidden" style="height: 600px; min-height: 600px;"></div>
                </div>
            </div>
        </div>

        <!-- ÌïòÎã®: Ï∂îÏ≤ú Í¥ÄÍ¥ëÏßÄ -->
        <section class="max-w-7xl mx-auto mt-8">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-white mb-2">üåü Ïù¥Î≤à Ï£ºÎßê Ï∂îÏ≤ú ÏïàÏã¨ Í¥ÄÍ¥ëÏßÄ</h2>
                <p class="text-white/80">ÏùòÎ£åÏßÑÏù¥ Ï∂îÏ≤úÌïòÎäî ÏïàÏ†ÑÌïú Ïó¨ÌñâÏßÄ</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- ÏÑ§ÏïÖÏÇ∞ -->
                <div class="modern-card p-0 overflow-hidden group cursor-pointer" onclick="moveToPlace(38.1192, 128.4651, 'ÏÑ§ÏïÖÏÇ∞')">
                    <div class="h-48 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-6xl group-hover:scale-110 transition-transform duration-500">
                        üèîÔ∏è
                    </div>
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800">ÏÑ§ÏïÖÏÇ∞ Íµ≠Î¶ΩÍ≥µÏõê</h3>
                            <span class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-3 py-1 rounded-full text-xs font-medium">
                                Ïö∞Ïàò ÏïàÏã¨
                            </span>
                        </div>
                        
                        <div class="flex items-center space-x-2 mb-4">
                            <span class="text-3xl font-bold gradient-text">87</span>
                            <div class="flex-1 bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-1000" style="width: 87%"></div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-2 mb-4">
                            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs">24ÏãúÍ∞Ñ ÏùëÍ∏âÏã§</span>
                            <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs">Ìó¨Í∏∞ Ï∞©Î•ôÏû•</span>
                        </div>
                    </div>
                </div>

                <!-- Ï†úÏ£ºÎèÑ -->
                <div class="modern-card p-0 overflow-hidden group cursor-pointer" onclick="moveToPlace(33.3617, 126.5292, 'Ï†úÏ£º ÌïúÎùºÏÇ∞')">
                    <div class="h-48 bg-gradient-to-br from-green-400 to-emerald-500 flex items-center justify-center text-6xl group-hover:scale-110 transition-transform duration-500">
                        üèùÔ∏è
                    </div>
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800">Ï†úÏ£º ÌïúÎùºÏÇ∞</h3>
                            <span class="bg-gradient-to-r from-green-500 to-green-600 text-white px-3 py-1 rounded-full text-xs font-medium">
                                ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏïàÏã¨
                            </span>
                        </div>
                        
                        <div class="flex items-center space-x-2 mb-4">
                            <span class="text-3xl font-bold gradient-text">92</span>
                            <div class="flex-1 bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-green-500 to-emerald-600 h-3 rounded-full transition-all duration-1000" style="width: 92%"></div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-2 mb-4">
                            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs">Ï¢ÖÌï©Î≥ëÏõê 10Î∂Ñ</span>
                            <span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs">AED ÏôÑÎπÑ</span>
                        </div>
                    </div>
                </div>

                <!-- Î∂ÄÏÇ∞ Ìï¥Ïö¥ÎåÄ -->
                <div class="modern-card p-0 overflow-hidden group cursor-pointer" onclick="moveToPlace(35.1587, 129.1604, 'Î∂ÄÏÇ∞ Ìï¥Ïö¥ÎåÄ')">
                    <div class="h-48 bg-gradient-to-br from-yellow-400 to-orange-500 flex items-center justify-center text-6xl group-hover:scale-110 transition-transform duration-500">
                        üèñÔ∏è
                    </div>
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800">Î∂ÄÏÇ∞ Ìï¥Ïö¥ÎåÄ</h3>
                            <span class="bg-gradient-to-r from-green-500 to-green-600 text-white px-3 py-1 rounded-full text-xs font-medium">
                                ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏïàÏã¨
                            </span>
                        </div>
                        
                        <div class="flex items-center space-x-2 mb-4">
                            <span class="text-3xl font-bold gradient-text">95</span>
                            <div class="flex-1 bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-yellow-500 to-orange-500 h-3 rounded-full transition-all duration-1000" style="width: 95%"></div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-2 mb-4">
                            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs">Ìï¥ÏÉÅÍµ¨Ï°∞ÎåÄ</span>
                            <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs">ÏùòÎ£åÏßÑ ÏÉÅÏ£º</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- ÏùëÍ∏âÏÉÅÌô© Î™®Îã¨ -->
    <div id="emergencyModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="modern-card max-w-md w-full p-8">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center text-3xl mx-auto mb-4">
                    üö®
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">ÏùëÍ∏âÏÉÅÌô© ÎåÄÏùë</h3>
                <p class="text-gray-600">ÏÉÅÌô©ÏùÑ ÏÑ†ÌÉùÌïòÏãúÎ©¥ ÏµúÏ†ÅÏùò ÎåÄÏùëÏùÑ ÏïàÎÇ¥Ìï©ÎãàÎã§</p>
            </div>
            
            <div class="space-y-3 mb-6">
                <button class="emergency-type-btn w-full bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-2xl hover:scale-105 transition-transform" data-emergency="chest_pain">
                    üíî Í∞ÄÏä¥ ÌÜµÏ¶ù / Ìò∏Ìù°Í≥§ÎûÄ
                </button>
                <button class="emergency-type-btn w-full bg-gradient-to-r from-orange-500 to-red-500 text-white p-4 rounded-2xl hover:scale-105 transition-transform" data-emergency="unconscious">
                    üèÉ‚Äç‚ôÇÔ∏è ÏùòÏãùÏûÉÏùå / Ïì∞Îü¨Ïßê
                </button>
                <button class="emergency-type-btn w-full bg-gradient-to-r from-red-600 to-pink-600 text-white p-4 rounded-2xl hover:scale-105 transition-transform" data-emergency="bleeding">
                    ü©∏ Ïã¨Ìïú Ï∂úÌòà / Ïô∏ÏÉÅ
                </button>
                <button class="emergency-type-btn w-full bg-gradient-to-r from-gray-600 to-gray-700 text-white p-4 rounded-2xl hover:scale-105 transition-transform" data-emergency="other">
                    ‚ö†Ô∏è Í∏∞ÌÉÄ ÏùëÍ∏âÏÉÅÌô©
                </button>
            </div>
            
            <div class="flex space-x-3">
                <button id="call119" class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white p-4 rounded-2xl font-medium hover:scale-105 transition-transform">
                    üìû 119 Ïã†Í≥†
                </button>
                <button id="closeEmergencyModal" class="flex-1 bg-gray-200 text-gray-700 p-4 rounded-2xl font-medium hover:bg-gray-300 transition-colors">
                    Ï∑®ÏÜå
                </button>
            </div>
        </div>
    </div>

    <!-- Î°úÎî© -->
    <div id="loading" class="fixed inset-0 bg-gradient-to-br from-blue-500 to-purple-600 z-50 flex items-center justify-center">
        <div class="text-center text-white">
            <div class="w-16 h-16 border-4 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-4"></div>
            <h3 class="text-xl font-semibold mb-2">ÏïàÏã¨Ïó¨Ìñâ Ïä§ÌÖù</h3>
            <p class="text-white/80">Ï†ÑÍµ≠ ÏïàÏã¨ Í¥ÄÍ¥ëÏßÄÎ•º Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
        </div>
    </div>

    <!-- Ïπ¥Ïπ¥Ïò§Îßµ API ÎèôÏ†Å Î°úÎìú -->
    <script>
        let map;
        let markers = [];
        let isMapLoaded = false;

        // Ïπ¥Ïπ¥Ïò§Îßµ API Î°úÎìú
        function loadKakaoMapAPI() {
            return new Promise((resolve, reject) => {
                if (window.kakao && window.kakao.maps) {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = '//dapi.kakao.com/v2/maps/sdk.js?appkey=cb042192382ed6a341ff3f2649753c8f&libraries=services&autoload=false';
                
                script.onload = function() {
                    kakao.maps.load(function() {
                        console.log('Ïπ¥Ïπ¥Ïò§Îßµ API Î°úÎìú ÏôÑÎ£å');
                        resolve();
                    });
                };
                
                script.onerror = function() {
                    console.error('Ïπ¥Ïπ¥Ïò§Îßµ API Î°úÎìú Ïã§Ìå®');
                    reject(new Error('Ïπ¥Ïπ¥Ïò§Îßµ API Î°úÎìú Ïã§Ìå®'));
                };
                
                document.head.appendChild(script);
            });
        }

        // ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî
        async function initializeMap() {
            const container = document.getElementById('map');
            
            // Ïª®ÌÖåÏù¥ÎÑà ÌÅ¨Í∏∞ Í∞ïÏ†ú ÏÑ§Ï†ï
            container.style.width = '100%';
            container.style.height = '600px';
            container.style.position = 'relative';
            
            const options = {
                center: new kakao.maps.LatLng(36.5, 127.8), // ÌïúÍµ≠ Ï§ëÏã¨
                level: 7,
                mapTypeId: kakao.maps.MapTypeId.ROADMAP
            };
            
            map = new kakao.maps.Map(container, options);
            
            // ÏßÄÎèÑ ÌÅ¨Í∏∞ Ïû¨Ï°∞Ï†ï (Ï§ëÏöî!)
            setTimeout(() => {
                map.relayout();
            }, 100);
            
            // ÏßÄÎèÑ ÏôÑÏ†Ñ Î°úÎìú ÌõÑ ÎßàÏª§ Ï∂îÍ∞Ä
            kakao.maps.event.addListener(map, 'tilesloaded', function() {
                if (!isMapLoaded) {
                    isMapLoaded = true;
                    addDemoMarkers();
                }
            });

            // ÏßÄÎèÑ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
            kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
                const latlng = mouseEvent.latLng;
                updateSafetyScore(Math.floor(Math.random() * 20) + 80);
            });
        }

        // Îç∞Î™® ÎßàÏª§ Ï∂îÍ∞Ä
        function addDemoMarkers() {
            const places = [
                { name: 'ÏÑ§ÏïÖÏÇ∞', lat: 38.1192, lng: 128.4651, score: 87 },
                { name: 'Ï†úÏ£º ÌïúÎùºÏÇ∞', lat: 33.3617, lng: 126.5292, score: 92 },
                { name: 'Î∂ÄÏÇ∞ Ìï¥Ïö¥ÎåÄ', lat: 35.1587, lng: 129.1604, score: 95 },
                { name: 'Í≤ΩÏ£º Î∂àÍµ≠ÏÇ¨', lat: 35.7898, lng: 129.3320, score: 89 },
                { name: 'Ïó¨Ïàò Ïò§ÎèôÎèÑ', lat: 34.7465, lng: 127.7699, score: 84 },
                { name: 'Ï†ÑÏ£º ÌïúÏò•ÎßàÏùÑ', lat: 35.8150, lng: 127.1530, score: 91 }
            ];

            places.forEach(place => {
                const position = new kakao.maps.LatLng(place.lat, place.lng);
                const color = place.score >= 90 ? '#10b981' : place.score >= 80 ? '#3b82f6' : '#f59e0b';
                
                const markerContent = `
                    <div style="
                        background: ${color};
                        color: white;
                        padding: 8px 12px;
                        border-radius: 20px;
                        font-size: 12px;
                        font-weight: bold;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                        border: 2px solid white;
                        cursor: pointer;
                        white-space: nowrap;
                    ">
                        üèÜ ${place.score}Ï†ê
                    </div>
                `;

                const overlay = new kakao.maps.CustomOverlay({
                    position: position,
                    content: markerContent,
                    yAnchor: 1
                });

                overlay.setMap(map);
                
                // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
                const element = overlay.getContent();
                element.addEventListener('click', () => {
                    showPlaceInfo(place);
                });

                markers.push(overlay);
            });
        }

        // Ïû•ÏÜå Ï†ïÎ≥¥ ÌëúÏãú
        function showPlaceInfo(place) {
            alert(`üèÜ ${place.name}\n\nüõ°Ô∏è ÏïàÏ†ÑÎèÑ: ${place.score}/100Ï†ê\n\nÏôÑÎ≤ΩÌïú ÏïàÏ†Ñ ÏãúÏÑ§Î°ú Í∞ÄÏ°± Î™®Îëê ÏïàÏã¨ÌïòÍ≥† Ï¶êÍ∏∏ Ïàò ÏûàÎäî Ïó¨ÌñâÏßÄÏûÖÎãàÎã§! üòä`);
        }

        // Ïû•ÏÜåÎ°ú Ïù¥Îèô
        function moveToPlace(lat, lng, name) {
            if (map) {
                const position = new kakao.maps.LatLng(lat, lng);
                map.setCenter(position);
                map.setLevel(6);
                updateSafetyScore(Math.floor(Math.random() * 15) + 85);
                showNotification(`${name}Î°ú Ïù¥ÎèôÌñàÏäµÎãàÎã§! üéØ`);
            }
        }

        // ÏïàÏ†ÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateSafetyScore(score) {
            const scoreElement = document.getElementById('safetyScore');
            const circle = document.querySelector('.safety-score-circle');
            
            scoreElement.textContent = score;
            circle.style.setProperty('--score-percent', score + '%');
            circle.style.setProperty('--final-score', score + '%');
        }

        // ÏïåÎ¶º ÌëúÏãú
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-6 right-6 bg-white rounded-2xl shadow-xl p-4 z-50 transform translate-x-full transition-transform duration-300';
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white">‚úì</div>
                    <span class="font-medium">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Ïï± Ï¥àÍ∏∞Ìôî
        async function initApp() {
            try {
                await loadKakaoMapAPI();
                await initializeMap();
                initEventListeners();
                
                // Î°úÎî© ÌôîÎ©¥ Ïà®Í∏∞Í∏∞
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    showNotification('ÏïàÏã¨Ïó¨Ìñâ Ïä§ÌÖùÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§! üéâ');
                }, 1000);
                
            } catch (error) {
                console.error('Ïï± Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="text-center text-white">
                        <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                        <h3 class="text-xl font-semibold mb-2">ÏßÄÎèÑ Î°úÎî© Ïã§Ìå®</h3>
                        <p class="mb-4">ÎÑ§Ìä∏ÏõåÌÅ¨Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî</p>
                        <button onclick="location.reload()" class="bg-white text-purple-600 px-6 py-3 rounded-2xl font-medium">
                            Îã§Ïãú ÏãúÎèÑ
                        </button>
                    </div>
                `;
            }
        }

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï¥àÍ∏∞Ìôî
        function initEventListeners() {
            // ÌòÑÏû¨ ÏúÑÏπò
            document.getElementById('currentLocationBtn').addEventListener('click', function() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            const latlng = new kakao.maps.LatLng(lat, lng);
                            
                            map.setCenter(latlng);
                            map.setLevel(5);
                            updateSafetyScore(Math.floor(Math.random() * 20) + 80);
                            showNotification('ÌòÑÏû¨ ÏúÑÏπòÎ•º ÌôïÏù∏ÌñàÏäµÎãàÎã§! üìç');
                        },
                        function() {
                            showNotification('ÏúÑÏπò Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§ üòÖ');
                        }
                    );
                }
            });

            // Í≤ÄÏÉâ
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') performSearch();
            });

            // ÏùëÍ∏âÏÉÅÌô©
            document.getElementById('emergencyBtn').addEventListener('click', function() {
                document.getElementById('emergencyModal').classList.remove('hidden');
            });

            document.getElementById('closeEmergencyModal').addEventListener('click', function() {
                document.getElementById('emergencyModal').classList.add('hidden');
            });

            // ÏùëÍ∏âÏÉÅÌô© Î≤ÑÌäºÎì§
            document.querySelectorAll('.emergency-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.dataset.emergency;
                    handleEmergency(type);
                });
            });

            document.getElementById('call119').addEventListener('click', function() {
                alert('119Ïóê Ïã†Í≥†ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏã§Ï†ú ÏùëÍ∏âÏÉÅÌô©ÏóêÏÑúÎäî Ï¶âÏãú 119Ïóê Ïã†Í≥†ÌïòÏÑ∏Ïöî.\n\nÌòÑÏû¨Îäî Îç∞Î™® Î≤ÑÏ†ÑÏûÖÎãàÎã§.');
            });
        }

        // Í≤ÄÏÉâ
        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            if (window.kakao && window.kakao.maps) {
                const ps = new kakao.maps.services.Places();
                ps.keywordSearch(query, function(data, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        const place = data[0];
                        const position = new kakao.maps.LatLng(place.y, place.x);
                        map.setCenter(position);
                        map.setLevel(5);
                        updateSafetyScore(Math.floor(Math.random() * 20) + 80);
                        showNotification(`${place.place_name}ÏùÑ(Î•º) Ï∞æÏïòÏäµÎãàÎã§! üéâ`);
                    } else {
                        showNotification('Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§ üîç');
                    }
                });
            }
        }

        // ÏùëÍ∏âÏÉÅÌô© Ï≤òÎ¶¨
        function handleEmergency(type) {
            const emergencyInfo = {
                chest_pain: { hospital: 'Ïã¨Ïû•ÎÇ¥Í≥º', time: '3Î∂Ñ', name: 'Í∞ïÎÇ®ÏÑ∏Î∏åÎûÄÏä§Î≥ëÏõê' },
                unconscious: { hospital: 'ÏùëÍ∏âÏã§', time: '2Î∂Ñ', name: 'ÏÇºÏÑ±ÏÑúÏö∏Î≥ëÏõê' },
                bleeding: { hospital: 'Ïô∏ÏÉÅÏô∏Í≥º', time: '4Î∂Ñ', name: 'ÏÑúÏö∏ÏïÑÏÇ∞Î≥ëÏõê' },
                other: { hospital: 'ÏùëÍ∏âÏã§', time: '5Î∂Ñ', name: 'ÏÑúÏö∏ÎåÄÌïôÍµêÎ≥ëÏõê' }
            };

            const info = emergencyInfo[type];
            alert(`üö® ÏùëÍ∏âÏÉÅÌô© ÎåÄÏùë ÏïàÎÇ¥\n\nÍ∞ÄÏû• Ï†ÅÌï©Ìïú Î≥ëÏõê: ${info.name}\nÏ†ÑÎ¨∏Í≥º: ${info.hospital}\nÏòàÏÉÅ ÎèÑÏ∞©ÏãúÍ∞Ñ: ${info.time}\n\nÏ¶âÏãú 119Ïóê Ïã†Í≥†ÌïòÍ≥† Î≥ëÏõêÏúºÎ°ú Ïù¥ÎèôÌïòÏÑ∏Ïöî.`);
            
            document.getElementById('emergencyModal').classList.add('hidden');
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ïï± ÏãúÏûë
        document.addEventListener('DOMContentLoaded', initApp);

        // ÏúàÎèÑÏö∞ Î¶¨ÏÇ¨Ïù¥Ï¶à Ïãú ÏßÄÎèÑ ÌÅ¨Í∏∞ Ïû¨Ï°∞Ï†ï
        window.addEventListener('resize', function() {
            if (map) {
                setTimeout(() => {
                    map.relayout();
                }, 100);
            }
        });
    </script>
</body>
</html>
