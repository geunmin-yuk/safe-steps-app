<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•ˆì‹¬ì—¬í–‰ ìŠ¤í… - Safe Steps</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-glow {
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .safety-score-circle {
            background: conic-gradient(
                #10b981 0% var(--score-percent), 
                #e5e7eb var(--score-percent) 100%
            );
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: scoreAnimation 2s ease-out;
        }
        
        .safety-score-inner {
            background: white;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        @keyframes scoreAnimation {
            from { --score-percent: 0%; }
            to { --score-percent: var(--final-score); }
        }
        
        .modern-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 24px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .modern-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .pulse-dot {
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            position: relative;
            animation: pulse 2s infinite;
        }
        
        .pulse-dot::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border-radius: 50%;
            background: #10b981;
            opacity: 0.6;
            animation: pulse-ring 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes pulse-ring {
            0% { transform: scale(1); opacity: 0.6; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        .floating-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            width: 56px;
            height: 56px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }
        
        .floating-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }
        
        .emergency-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            animation: emergencyPulse 2s infinite;
        }
        
        @keyframes emergencyPulse {
            0%, 100% { box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 8px 35px rgba(239, 68, 68, 0.8); }
        }
        
        .hero-section {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: 32px;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(20px);
        }
        
        .search-input {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            background: rgba(255,255,255,1);
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
    </style>
</head>

<body>
    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="min-h-screen p-4">
        <!-- í—¤ë” -->
        <header class="hero-section p-6 mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-2xl shadow-lg">
                        âœˆï¸
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">ì•ˆì‹¬ì—¬í–‰ ìŠ¤í…</h1>
                        <p class="text-white/80 text-sm">Safe & Smart Travel Guide</p>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button id="currentLocationBtn" class="floating-btn flex items-center justify-center text-white hover:scale-105 transition-transform">
                        <i class="fas fa-location-dot text-lg"></i>
                    </button>
                    <button id="emergencyBtn" class="floating-btn emergency-btn flex items-center justify-center text-white">
                        <i class="fas fa-phone text-lg"></i>
                    </button>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto grid grid-cols-1 xl:grid-cols-3 gap-8">
            <!-- ì™¼ìª½: ê²€ìƒ‰ & ì•ˆì „ë„ -->
            <div class="xl:col-span-1 space-y-6">
                <!-- ê²€ìƒ‰ ì„¹ì…˜ -->
                <div class="modern-card p-6">
                    <div class="mb-4">
                        <h2 class="text-xl font-semibold gradient-text mb-2">ì—¬í–‰ì§€ ê²€ìƒ‰</h2>
                        <div class="relative">
                            <input 
                                type="text" 
                                id="searchInput" 
                                placeholder="ì–´ë””ë¡œ ë– ë‚˜ì‹œë‚˜ìš”?"
                                class="search-input w-full px-6 py-4 text-lg focus:outline-none"
                            >
                            <button id="searchBtn" class="absolute right-2 top-2 w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:scale-105 transition-transform">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- í˜„ì¬ ìœ„ì¹˜ ì•ˆì „ë„ -->
                <div id="safetyCard" class="modern-card p-8 text-center">
                    <div class="mb-6">
                        <h3 class="text-lg font-medium text-gray-600 mb-4">í˜„ì¬ ìœ„ì¹˜ ì•ˆì „ë„</h3>
                        <div class="flex justify-center mb-4">
                            <div class="safety-score-circle" style="--score-percent: 95%; --final-score: 95%;">
                                <div class="safety-score-inner">
                                    <span class="text-3xl font-bold text-green-600" id="safetyScore">95</span>
                                    <span class="text-sm text-gray-500">ì </span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center justify-center space-x-2 mb-4">
                            <div class="pulse-dot"></div>
                            <span class="text-green-600 font-semibold">ì™„ë²½í•œ ì•ˆì‹¬ ì§€ì—­</span>
                        </div>
                    </div>
                    
                    <!-- í•µì‹¬ ì•ˆì „ ì •ë³´ -->
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-green-50 rounded-2xl p-4">
                            <div class="text-2xl mb-1">ğŸ¥</div>
                            <div class="text-xs text-gray-600">ì‘ê¸‰ì‹¤</div>
                            <div class="text-lg font-bold text-green-600">4ë¶„</div>
                        </div>
                        <div class="bg-red-50 rounded-2xl p-4">
                            <div class="text-2xl mb-1">âš¡</div>
                            <div class="text-xs text-gray-600">AED</div>
                            <div class="text-lg font-bold text-red-600">1ë¶„</div>
                        </div>
                        <div class="bg-blue-50 rounded-2xl p-4">
                            <div class="text-2xl mb-1">ğŸ’Š</div>
                            <div class="text-xs text-gray-600">ì•½êµ­</div>
                            <div class="text-lg font-bold text-blue-600">6ë¶„</div>
                        </div>
                    </div>
                </div>

                <!-- ë¹ ë¥¸ ì•¡ì…˜ -->
                <div class="modern-card p-6">
                    <h3 class="text-lg font-semibold mb-4">ë¹ ë¥¸ ì„œë¹„ìŠ¤</h3>
                    <div class="space-y-3">
                        <button class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4 rounded-2xl font-medium hover:scale-105 transition-transform">
                            ğŸ”ï¸ ì‚°ì•… ì—¬í–‰ ì•ˆì „ ê°€ì´ë“œ
                        </button>
                        <button class="w-full bg-gradient-to-r from-blue-500 to-cyan-600 text-white py-4 rounded-2xl font-medium hover:scale-105 transition-transform">
                            ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì—¬í–‰ ì¶”ì²œ
                        </button>
                        <button class="w-full bg-gradient-to-r from-purple-500 to-pink-600 text-white py-4 rounded-2xl font-medium hover:scale-105 transition-transform">
                            ğŸ¯ ë§ì¶¤í˜• ì•ˆì „ ì²´í¬
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ì§€ë„ -->
            <div class="xl:col-span-2">
                <div class="modern-card p-6 h-full">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h2 class="text-xl font-semibold gradient-text">ì‹¤ì‹œê°„ ì•ˆì‹¬ ì§€ë„</h2>
                            <p class="text-gray-500 text-sm">ì „êµ­ ê´€ê´‘ì§€ ì•ˆì „ ì •ë³´</p>
                        </div>
                        <div class="flex space-x-2">
                            <div class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-medium">
                                ğŸ¥ ë³‘ì› <span id="hospitalCount">3</span>
                            </div>
                            <div class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-medium">
                                âš¡ AED <span id="aedCount">2</span>
                            </div>
                            <div class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-medium">
                                ğŸ’Š ì•½êµ­ <span id="pharmacyCount">24</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì¹´ì¹´ì˜¤ë§µ -->
                    <div id="map" class="w-full rounded-2xl overflow-hidden" style="height: 600px; min-height: 600px;"></div>
                </div>
            </div>
        </div>

        <!-- í•˜ë‹¨: ì¶”ì²œ ê´€ê´‘ì§€ -->
        <section class="max-w-7xl mx-auto mt-8">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-white mb-2">ğŸŒŸ ì´ë²ˆ ì£¼ë§ ì¶”ì²œ ì•ˆì‹¬ ê´€ê´‘ì§€</h2>
                <p class="text-white/80">ì˜ë£Œì§„ì´ ì¶”ì²œí•˜ëŠ” ì•ˆì „í•œ ì—¬í–‰ì§€</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- ì„¤ì•…ì‚° -->
                <div class="modern-card p-0 overflow-hidden group cursor-pointer" onclick="moveToPlace(38.1192, 128.4651, 'ì„¤ì•…ì‚°')">
                    <div class="h-48 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-6xl group-hover:scale-110 transition-transform duration-500">
                        ğŸ”ï¸
                    </div>
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800">ì„¤ì•…ì‚° êµ­ë¦½ê³µì›</h3>
                            <span class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-3 py-1 rounded-full text-xs font-medium">
                                ìš°ìˆ˜ ì•ˆì‹¬
                            </span>
                        </div>
                        
                        <div class="flex items-center space-x-2 mb-4">
                            <span class="text-3xl font-bold gradient-text">87</span>
                            <div class="flex-1 bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-1000" style="width: 87%"></div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-2 mb-4">
                            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs">24ì‹œê°„ ì‘ê¸‰ì‹¤</span>
                            <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs">í—¬ê¸° ì°©ë¥™ì¥</span>
                        </div>
                    </div>
                </div>

                <!-- ì œì£¼ë„ -->
                <div class="modern-card p-0 overflow-hidden group cursor-pointer" onclick="moveToPlace(33.3617, 126.5292, 'ì œì£¼ í•œë¼ì‚°')">
                    <div class="h-48 bg-gradient-to-br from-green-400 to-emerald-500 flex items-center justify-center text-6xl group-hover:scale-110 transition-transform duration-500">
                        ğŸï¸
                    </div>
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800">ì œì£¼ í•œë¼ì‚°</h3>
                            <span class="bg-gradient-to-r from-green-500 to-green-600 text-white px-3 py-1 rounded-full text-xs font-medium">
                                í”„ë¦¬ë¯¸ì—„ ì•ˆì‹¬
                            </span>
                        </div>
                        
                        <div class="flex items-center space-x-2 mb-4">
                            <span class="text-3xl font-bold gradient-text">92</span>
                            <div class="flex-1 bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-green-500 to-emerald-600 h-3 rounded-full transition-all duration-1000" style="width: 92%"></div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-2 mb-4">
                            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs">ì¢…í•©ë³‘ì› 10ë¶„</span>
                            <span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs">AED ì™„ë¹„</span>
                        </div>
                    </div>
                </div>

                <!-- ë¶€ì‚° í•´ìš´ëŒ€ -->
                <div class="modern-card p-0 overflow-hidden group cursor-pointer" onclick="moveToPlace(35.1587, 129.1604, 'ë¶€ì‚° í•´ìš´ëŒ€')">
                    <div class="h-48 bg-gradient-to-br from-yellow-400 to-orange-500 flex items-center justify-center text-6xl group-hover:scale-110 transition-transform duration-500">
                        ğŸ–ï¸
                    </div>
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800">ë¶€ì‚° í•´ìš´ëŒ€</h3>
                            <span class="bg-gradient-to-r from-green-500 to-green-600 text-white px-3 py-1 rounded-full text-xs font-medium">
                                í”„ë¦¬ë¯¸ì—„ ì•ˆì‹¬
                            </span>
                        </div>
                        
                        <div class="flex items-center space-x-2 mb-4">
                            <span class="text-3xl font-bold gradient-text">95</span>
                            <div class="flex-1 bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-yellow-500 to-orange-500 h-3 rounded-full transition-all duration-1000" style="width: 95%"></div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-2 mb-4">
                            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs">í•´ìƒêµ¬ì¡°ëŒ€</span>
                            <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs">ì˜ë£Œì§„ ìƒì£¼</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- ì‘ê¸‰ìƒí™© ëª¨ë‹¬ -->
    <div id="emergencyModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="modern-card max-w-md w-full p-8">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center text-3xl mx-auto mb-4">
                    ğŸš¨
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">ì‘ê¸‰ìƒí™© ëŒ€ì‘</h3>
                <p class="text-gray-600">ìƒí™©ì„ ì„ íƒí•˜ì‹œë©´ ìµœì ì˜ ëŒ€ì‘ì„ ì•ˆë‚´í•©ë‹ˆë‹¤</p>
            </div>
            
            <div class="space-y-3 mb-6">
                <button class="emergency-type-btn w-full bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-2xl hover:scale-105 transition-transform" data-emergency="chest_pain">
                    ğŸ’” ê°€ìŠ´ í†µì¦ / í˜¸í¡ê³¤ë€
                </button>
                <button class="emergency-type-btn w-full bg-gradient-to-r from-orange-500 to-red-500 text-white p-4 rounded-2xl hover:scale-105 transition-transform" data-emergency="unconscious">
                    ğŸƒâ€â™‚ï¸ ì˜ì‹ìƒìŒ / ì“°ëŸ¬ì§
                </button>
                <button class="emergency-type-btn w-full bg-gradient-to-r from-red-600 to-pink-600 text-white p-4 rounded-2xl hover:scale-105 transition-transform" data-emergency="bleeding">
                    ğŸ©¸ ì‹¬í•œ ì¶œí˜ˆ / ì™¸ìƒ
                </button>
                <button class="emergency-type-btn w-full bg-gradient-to-r from-gray-600 to-gray-700 text-white p-4 rounded-2xl hover:scale-105 transition-transform" data-emergency="other">
                    âš ï¸ ê¸°íƒ€ ì‘ê¸‰ìƒí™©
                </button>
            </div>
            
            <div class="flex space-x-3">
                <button id="call119" class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white p-4 rounded-2xl font-medium hover:scale-105 transition-transform">
                    ğŸ“ 119 ì‹ ê³ 
                </button>
                <button id="closeEmergencyModal" class="flex-1 bg-gray-200 text-gray-700 p-4 rounded-2xl font-medium hover:bg-gray-300 transition-colors">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    </div>

    <!-- ë¡œë”© -->
    <div id="loading" class="fixed inset-0 bg-gradient-to-br from-blue-500 to-purple-600 z-50 flex items-center justify-center">
        <div class="text-center text-white">
            <div class="w-16 h-16 border-4 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-4"></div>
            <h3 class="text-xl font-semibold mb-2">ì•ˆì‹¬ì—¬í–‰ ìŠ¤í…</h3>
            <p class="text-white/80">ì „êµ­ ì•ˆì‹¬ ê´€ê´‘ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
    </div>

    <!-- ì¹´ì¹´ì˜¤ë§µ API ë™ì  ë¡œë“œ -->
    <script>
        let map;
        let markers = [];
        let isMapLoaded = false;

        // ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ
        function loadKakaoMapAPI() {
            return new Promise((resolve, reject) => {
                if (window.kakao && window.kakao.maps) {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = '//dapi.kakao.com/v2/maps/sdk.js?appkey=cb042192382ed6a341ff3f2649753c8f&libraries=services&autoload=false';
                
                script.onload = function() {
                    kakao.maps.load(function() {
                        console.log('ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ ì™„ë£Œ');
                        resolve();
                    });
                };
                
                script.onerror = function() {
                    console.error('ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ ì‹¤íŒ¨');
                    reject(new Error('ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ ì‹¤íŒ¨'));
                };
                
                document.head.appendChild(script);
            });
        }

        // ì§€ë„ ì´ˆê¸°í™”
        async function initializeMap() {
            const container = document.getElementById('map');
            
            // ì»¨í…Œì´ë„ˆ í¬ê¸° ê°•ì œ ì„¤ì •
            container.style.width = '100%';
            container.style.height = '600px';
            container.style.position = 'relative';
            
            const options = {
                center: new kakao.maps.LatLng(36.5, 127.8), // í•œêµ­ ì¤‘ì‹¬
                level: 7,
                mapTypeId: kakao.maps.MapTypeId.ROADMAP
            };
            
            map = new kakao.maps.Map(container, options);
            
            // ì§€ë„ í¬ê¸° ì¬ì¡°ì • (ì¤‘ìš”!)
            setTimeout(() => {
                map.relayout();
            }, 100);
            
            // ì§€ë„ ì™„ì „ ë¡œë“œ í›„ ë§ˆì»¤ ì¶”ê°€
            kakao.maps.event.addListener(map, 'tilesloaded', function() {
                if (!isMapLoaded) {
                    isMapLoaded = true;
                    addDemoMarkers();
                }
            });

            // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸
            kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
                const latlng = mouseEvent.latLng;
                updateSafetyScore(Math.floor(Math.random() * 20) + 80);
            });
        }

        // ë°ëª¨ ë§ˆì»¤ ì¶”ê°€
        function addDemoMarkers() {
            const places = [
                { name: 'ì„¤ì•…ì‚°', lat: 38.1192, lng: 128.4651, score: 87 },
                { name: 'ì œì£¼ í•œë¼ì‚°', lat: 33.3617, lng: 126.5292, score: 92 },
                { name: 'ë¶€ì‚° í•´ìš´ëŒ€', lat: 35.1587, lng: 129.1604, score: 95 },
                { name: 'ê²½ì£¼ ë¶ˆêµ­ì‚¬', lat: 35.7898, lng: 129.3320, score: 89 },
                { name: 'ì—¬ìˆ˜ ì˜¤ë™ë„', lat: 34.7465, lng: 127.7699, score: 84 },
                { name: 'ì „ì£¼ í•œì˜¥ë§ˆì„', lat: 35.8150, lng: 127.1530, score: 91 }
            ];

            places.forEach(place => {
                const position = new kakao.maps.LatLng(place.lat, place.lng);
                const color = place.score >= 90 ? '#10b981' : place.score >= 80 ? '#3b82f6' : '#f59e0b';
                
                const markerContent = `
                    <div style="
                        background: ${color};
                        color: white;
                        padding: 8px 12px;
                        border-radius: 20px;
                        font-size: 12px;
                        font-weight: bold;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                        border: 2px solid white;
                        cursor: pointer;
                        white-space: nowrap;
                    ">
                        ğŸ† ${place.score}ì 
                    </div>
                `;

                const overlay = new kakao.maps.CustomOverlay({
                    position: position,
                    content: markerContent,
                    yAnchor: 1
                });

                overlay.setMap(map);
                
                // í´ë¦­ ì´ë²¤íŠ¸
                const element = overlay.getContent();
                element.addEventListener('click', () => {
                    showPlaceInfo(place);
                });

                markers.push(overlay);
            });
        }

        // ì¥ì†Œ ì •ë³´ í‘œì‹œ
        function showPlaceInfo(place) {
            alert(`ğŸ† ${place.name}\n\nğŸ›¡ï¸ ì•ˆì „ë„: ${place.score}/100ì \n\nì™„ë²½í•œ ì•ˆì „ ì‹œì„¤ë¡œ ê°€ì¡± ëª¨ë‘ ì•ˆì‹¬í•˜ê³  ì¦ê¸¸ ìˆ˜ ìˆëŠ” ì—¬í–‰ì§€ì…ë‹ˆë‹¤! ğŸ˜Š`);
        }

        // ì¥ì†Œë¡œ ì´ë™
        function moveToPlace(lat, lng, name) {
            if (map) {
                const position = new kakao.maps.LatLng(lat, lng);
                map.setCenter(position);
                map.setLevel(6);
                updateSafetyScore(Math.floor(Math.random() * 15) + 85);
                showNotification(`${name}ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤! ğŸ¯`);
            }
        }

        // ì•ˆì „ë„ ì—…ë°ì´íŠ¸
        function updateSafetyScore(score) {
            const scoreElement = document.getElementById('safetyScore');
            const circle = document.querySelector('.safety-score-circle');
            
            scoreElement.textContent = score;
            circle.style.setProperty('--score-percent', score + '%');
            circle.style.setProperty('--final-score', score + '%');
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-6 right-6 bg-white rounded-2xl shadow-xl p-4 z-50 transform translate-x-full transition-transform duration-300';
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white">âœ“</div>
                    <span class="font-medium">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ì•± ì´ˆê¸°í™”
        async function initApp() {
            try {
                await loadKakaoMapAPI();
                await initializeMap();
                initEventListeners();
                
                // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    showNotification('ì•ˆì‹¬ì—¬í–‰ ìŠ¤í…ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‰');
                }, 1000);
                
            } catch (error) {
                console.error('ì•± ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="text-center text-white">
                        <div class="text-6xl mb-4">âš ï¸</div>
                        <h3 class="text-xl font-semibold mb-2">ì§€ë„ ë¡œë”© ì‹¤íŒ¨</h3>
                        <p class="mb-4">ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”</p>
                        <button onclick="location.reload()" class="bg-white text-purple-600 px-6 py-3 rounded-2xl font-medium">
                            ë‹¤ì‹œ ì‹œë„
                        </button>
                    </div>
                `;
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
        function initEventListeners() {
            // í˜„ì¬ ìœ„ì¹˜
            document.getElementById('currentLocationBtn').addEventListener('click', function() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            const latlng = new kakao.maps.LatLng(lat, lng);
                            
                            map.setCenter(latlng);
                            map.setLevel(5);
                            updateSafetyScore(Math.floor(Math.random() * 20) + 80);
                            showNotification('í˜„ì¬ ìœ„ì¹˜ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤! ğŸ“');
                        },
                        function() {
                            showNotification('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ ğŸ˜…');
                        }
                    );
                }
            });

            // ê²€ìƒ‰
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') performSearch();
            });

            // ì‘ê¸‰ìƒí™©
            document.getElementById('emergencyBtn').addEventListener('click', function() {
                document.getElementById('emergencyModal').classList.remove('hidden');
            });

            document.getElementById('closeEmergencyModal').addEventListener('click', function() {
                document.getElementById('emergencyModal').classList.add('hidden');
            });

            // ì‘ê¸‰ìƒí™© ë²„íŠ¼ë“¤
            document.querySelectorAll('.emergency-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.dataset.emergency;
                    handleEmergency(type);
                });
            });

            document.getElementById('call119').addEventListener('click', function() {
                alert('119ì— ì‹ ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‹¤ì œ ì‘ê¸‰ìƒí™©ì—ì„œëŠ” ì¦‰ì‹œ 119ì— ì‹ ê³ í•˜ì„¸ìš”.\n\ní˜„ì¬ëŠ” ë°ëª¨ ë²„ì „ì…ë‹ˆë‹¤.');
            });
        }

        // ê²€ìƒ‰
        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            if (window.kakao && window.kakao.maps) {
                const ps = new kakao.maps.services.Places();
                ps.keywordSearch(query, function(data, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        const place = data[0];
                        const position = new kakao.maps.LatLng(place.y, place.x);
                        map.setCenter(position);
                        map.setLevel(5);
                        updateSafetyScore(Math.floor(Math.random() * 20) + 80);
                        showNotification(`${place.place_name}ì„(ë¥¼) ì°¾ì•˜ìŠµë‹ˆë‹¤! ğŸ‰`);
                    } else {
                        showNotification('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤ ğŸ”');
                    }
                });
            }
        }

        // ì‘ê¸‰ìƒí™© ì²˜ë¦¬
        function handleEmergency(type) {
            const emergencyInfo = {
                chest_pain: { hospital: 'ì‹¬ì¥ë‚´ê³¼', time: '3ë¶„', name: 'ê°•ë‚¨ì„¸ë¸Œë€ìŠ¤ë³‘ì›' },
                unconscious: { hospital: 'ì‘ê¸‰ì‹¤', time: '2ë¶„', name: 'ì‚¼ì„±ì„œìš¸ë³‘ì›' },
                bleeding: { hospital: 'ì™¸ìƒì™¸ê³¼', time: '4ë¶„', name: 'ì„œìš¸ì•„ì‚°ë³‘ì›' },
                other: { hospital: 'ì‘ê¸‰ì‹¤', time: '5ë¶„', name: 'ì„œìš¸ëŒ€í•™êµë³‘ì›' }
            };

            const info = emergencyInfo[type];
            alert(`ğŸš¨ ì‘ê¸‰ìƒí™© ëŒ€ì‘ ì•ˆë‚´\n\nê°€ì¥ ì í•©í•œ ë³‘ì›: ${info.name}\nì „ë¬¸ê³¼: ${info.hospital}\nì˜ˆìƒ ë„ì°©ì‹œê°„: ${info.time}\n\nì¦‰ì‹œ 119ì— ì‹ ê³ í•˜ê³  ë³‘ì›ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”.`);
            
            document.getElementById('emergencyModal').classList.add('hidden');
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì•± ì‹œì‘
        document.addEventListener('DOMContentLoaded', initApp);

        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì§€ë„ í¬ê¸° ì¬ì¡°ì •
        window.addEventListener('resize', function() {
            if (map) {
                setTimeout(() => {
                    map.relayout();
                }, 100);
            }
        });
    </script>
</body>
</html>
